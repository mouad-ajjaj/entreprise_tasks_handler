name: Deploy React to Azure Storage

on:
  push:
    branches: [ main ]

permissions:
  id-token: write
  contents: read

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - name: Install and Build
      working-directory: ./frontend
      env:
        VITE_API_BASE_URL: https://func-projectazureemov2-hh6wh9.azurewebsites.net
      run: |
        npm install
        npm run build

    - name: Upload to Azure Storage
      uses: azure/CLI@v1
      with:
        inlineScript: |
          az storage blob upload-batch --destination '$web' --source ./frontend/dist --connection-string "${{ secrets.AZURE_STORAGE_CONNECTION_STRING }}" --overwrite
